<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Social URL Sanitization</title>
    <script src="js/signature.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        .test-case {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .result { margin-top: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Social URL Sanitization Tests</h1>
    <div id="test-results"></div>

    <script>
        const tests = [
            // LinkedIn tests
            { input: 'https://linkedin.com/in/username', domain: 'linkedin.com', expected: 'in/username', desc: 'Full LinkedIn URL' },
            { input: 'https://www.linkedin.com/in/username/', domain: 'linkedin.com', expected: 'in/username', desc: 'LinkedIn with www and trailing slash' },
            { input: 'in/username', domain: 'linkedin.com', expected: 'in/username', desc: 'LinkedIn username only' },
            { input: 'username', domain: 'linkedin.com', expected: 'username', desc: 'LinkedIn handle without path' },

            // X/Twitter tests
            { input: 'https://x.com/username', domain: 'x.com', expected: 'username', desc: 'Full X.com URL' },
            { input: 'https://www.x.com/username/', domain: 'x.com', expected: 'username', desc: 'X.com with www and trailing slash' },
            { input: 'https://twitter.com/username', domain: 'x.com', expected: 'username', desc: 'Old twitter.com URL' },
            { input: '@username', domain: 'x.com', expected: '@username', desc: 'X handle with @ symbol' },
            { input: 'username', domain: 'x.com', expected: 'username', desc: 'X username only' },

            // Edge cases
            { input: 'https://x.com/https://x.com/username', domain: 'x.com', expected: 'https://x.com/username', desc: 'Double URL bug (should extract)' },
            { input: '', domain: 'x.com', expected: '', desc: 'Empty input' },
        ];

        const resultsDiv = document.getElementById('test-results');

        tests.forEach((test, index) => {
            const result = SignatureGenerator.sanitizeSocialUrl(test.input, test.domain);
            const passed = result === test.expected;

            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';
            testDiv.innerHTML = `
                <div><strong>Test ${index + 1}:</strong> ${test.desc}</div>
                <div class="result">Input: "${test.input}"</div>
                <div class="result">Expected: "${test.expected}"</div>
                <div class="result">Got: "${result}"</div>
                <div class="${passed ? 'pass' : 'fail'}">${passed ? '✓ PASS' : '✗ FAIL'}</div>
            `;
            resultsDiv.appendChild(testDiv);
        });

        // Summary
        const passedCount = tests.filter((test) => {
            const result = SignatureGenerator.sanitizeSocialUrl(test.input, test.domain);
            return result === test.expected;
        }).length;

        const summaryDiv = document.createElement('div');
        summaryDiv.style.marginTop = '20px';
        summaryDiv.style.padding = '15px';
        summaryDiv.style.background = passedCount === tests.length ? '#d4edda' : '#f8d7da';
        summaryDiv.innerHTML = `<h2>Summary: ${passedCount}/${tests.length} tests passed</h2>`;
        resultsDiv.appendChild(summaryDiv);
    </script>
</body>
</html>